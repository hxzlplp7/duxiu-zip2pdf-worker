# ğŸ“š è¯»ç§€ZIPè½¬PDF Worker - ä¸€é”®éƒ¨ç½²æŒ‡å—

> æœ¬æ–‡æ¡£é¢å‘é›¶åŸºç¡€ç”¨æˆ·ï¼ŒæŒ‰æ­¥éª¤æ“ä½œå³å¯å®Œæˆéƒ¨ç½²

## ğŸ“‹ ç›®å½•

1. [å‰ç½®å‡†å¤‡](#1-å‰ç½®å‡†å¤‡)
2. [æ³¨å†ŒCloudflareè´¦å·](#2-æ³¨å†Œcloudflareè´¦å·)
3. [å®‰è£…Node.js](#3-å®‰è£…nodejs)
4. [ä¸‹è½½é¡¹ç›®ä»£ç ](#4-ä¸‹è½½é¡¹ç›®ä»£ç )
5. [ç™»å½•Cloudflare](#5-ç™»å½•cloudflare)
6. [åˆ›å»ºR2å­˜å‚¨æ¡¶](#6-åˆ›å»ºr2å­˜å‚¨æ¡¶)
7. [éƒ¨ç½²Worker](#7-éƒ¨ç½²worker)
8. [éªŒè¯éƒ¨ç½²](#8-éªŒè¯éƒ¨ç½²)
9. [å¸¸è§é”™è¯¯åŠè§£å†³](#9-å¸¸è§é”™è¯¯åŠè§£å†³)

---

## 1. å‰ç½®å‡†å¤‡

### ä½ éœ€è¦å‡†å¤‡ï¼š
- âœ… ä¸€å°Windows/Mac/Linuxç”µè„‘
- âœ… ç¨³å®šçš„ç½‘ç»œè¿æ¥
- âœ… ä¸€ä¸ªé‚®ç®±ï¼ˆç”¨äºæ³¨å†ŒCloudflareï¼‰

### é¢„è®¡æ—¶é—´ï¼šçº¦15åˆ†é’Ÿ

---

## 2. æ³¨å†ŒCloudflareè´¦å·

### 2.1 è®¿é—®Cloudflareå®˜ç½‘

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼šhttps://dash.cloudflare.com/sign-up

### 2.2 åˆ›å»ºè´¦å·

1. è¾“å…¥ä½ çš„é‚®ç®±
2. è®¾ç½®å¯†ç ï¼ˆè‡³å°‘8ä¸ªå­—ç¬¦ï¼‰
3. ç‚¹å‡» "Create Account"
4. å»é‚®ç®±éªŒè¯é‚®ä»¶

### 2.3 è·³è¿‡åŸŸåæ·»åŠ 

- æ³¨å†Œåä¼šæç¤ºæ·»åŠ ç½‘ç«™ï¼Œç›´æ¥ç‚¹å‡»å·¦ä¾§èœå•è·³è¿‡
- æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨Workerså’ŒR2åŠŸèƒ½

---

## 3. å®‰è£…Node.js

### 3.1 ä¸‹è½½Node.js

è®¿é—®ï¼šhttps://nodejs.org/zh-cn/

ç‚¹å‡»ä¸‹è½½ **LTSç‰ˆæœ¬**ï¼ˆé•¿æœŸæ”¯æŒç‰ˆï¼Œç›®å‰æ˜¯20.xæˆ–22.xï¼‰

### 3.2 å®‰è£…Node.js

1. åŒå‡»è¿è¡Œä¸‹è½½çš„å®‰è£…åŒ…
2. ä¸€è·¯ç‚¹å‡» "Next"
3. å‹¾é€‰ "Automatically install..." é€‰é¡¹
4. ç‚¹å‡» "Install"
5. ç­‰å¾…å®‰è£…å®Œæˆï¼Œç‚¹å‡» "Finish"

### 3.3 éªŒè¯å®‰è£…

æ‰“å¼€ **PowerShell**ï¼ˆWindowsæœç´¢æ è¾“å…¥ PowerShellï¼‰

è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```powershell
node --version
npm --version
```

å¦‚æœæ˜¾ç¤ºç‰ˆæœ¬å·ï¼ˆå¦‚ v20.11.0 å’Œ 10.2.0ï¼‰ï¼Œè¯´æ˜å®‰è£…æˆåŠŸã€‚

---

## 4. ä¸‹è½½é¡¹ç›®ä»£ç 

### æ–¹å¼ä¸€ï¼šé€šè¿‡Gitä¸‹è½½ï¼ˆæ¨èï¼‰

```powershell
# å®‰è£…Gitï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
winget install Git.Git

# å…‹éš†é¡¹ç›®
git clone https://github.com/hxzlplp7/duxiu-zip2pdf-worker.git

# è¿›å…¥é¡¹ç›®ç›®å½•
cd duxiu-zip2pdf-worker
```

### æ–¹å¼äºŒï¼šç›´æ¥ä¸‹è½½ZIP

1. è®¿é—®ï¼šhttps://github.com/hxzlplp7/duxiu-zip2pdf-worker
2. ç‚¹å‡»ç»¿è‰²çš„ "Code" æŒ‰é’®
3. é€‰æ‹© "Download ZIP"
4. è§£å‹åˆ°ä»»æ„ç›®å½•
5. åœ¨PowerShellä¸­è¿›å…¥è¯¥ç›®å½•ï¼š

```powershell
cd D:\ä½ çš„è§£å‹è·¯å¾„\duxiu-zip2pdf-worker-main
```

---

## 5. ç™»å½•Cloudflare

### 5.1 å®‰è£…Wranglerï¼ˆCloudflare CLIå·¥å…·ï¼‰

åœ¨é¡¹ç›®ç›®å½•ä¸‹è¿è¡Œï¼š

```powershell
npm install
```

ç­‰å¾…å®‰è£…å®Œæˆï¼ˆå¯èƒ½éœ€è¦1-2åˆ†é’Ÿï¼‰

### 5.2 ç™»å½•Cloudflare

```powershell
npx wrangler login
```

è¿™ä¼šï¼š
1. è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
2. æ˜¾ç¤ºCloudflareæˆæƒé¡µé¢
3. ç‚¹å‡» "Allow" æˆæƒ
4. çœ‹åˆ° "Successfully logged in" è¡¨ç¤ºæˆåŠŸ

---

## 6. åˆ›å»ºR2å­˜å‚¨æ¡¶

### 6.1 åˆ›å»ºå­˜å‚¨æ¡¶

è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```powershell
npx wrangler r2 bucket create duxiu-pdf-storage
```

### 6.2 æŸ¥çœ‹åˆ›å»ºç»“æœ

å¦‚æœæˆåŠŸï¼Œä¼šæ˜¾ç¤ºï¼š
```
âœ… Created bucket 'duxiu-pdf-storage' with default storage class of Standard.
```

### âš ï¸ å¦‚æœæŠ¥é”™

**é”™è¯¯ï¼šbucket already exists**
- è¯´æ˜ä½ ä¹‹å‰å·²ç»åˆ›å»ºè¿‡ï¼Œå¯ä»¥ç»§ç»­ä¸‹ä¸€æ­¥

**é”™è¯¯ï¼šR2 is not enabled**
- éœ€è¦åœ¨Cloudflare Dashboardä¸­å¯ç”¨R2
- è®¿é—®ï¼šhttps://dash.cloudflare.com/ â†’ R2 â†’ ç‚¹å‡»å¯ç”¨

---

## 7. éƒ¨ç½²Worker

### 7.1 éƒ¨ç½²

è¿è¡Œï¼š

```powershell
npm run deploy
```

### 7.2 æˆåŠŸæ ‡å¿—

çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹è¾“å‡ºè¡¨ç¤ºæˆåŠŸï¼š

```
Total Upload: 883.18 KiB / gzip: 230.93 KiB
Worker Startup Time: 20 ms
Your Worker has access to the following bindings:
  env.BUCKET (duxiu-pdf-storage)      R2 Bucket

Uploaded duxiu-zip2pdf-worker (5.71 sec)
Deployed duxiu-zip2pdf-worker triggers (1.52 sec)
  https://duxiu-zip2pdf-worker.ä½ çš„ID.workers.dev
```

**è®°ä¸‹è¿™ä¸ªURL**ï¼Œè¿™å°±æ˜¯ä½ çš„åœ¨çº¿å·¥å…·åœ°å€ï¼

---

## 8. éªŒè¯éƒ¨ç½²

### 8.1 è®¿é—®ä½ çš„Worker

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€éƒ¨ç½²æˆåŠŸæ˜¾ç¤ºçš„URLï¼š
```
https://duxiu-zip2pdf-worker.ä½ çš„ID.workers.dev
```

### 8.2 åº”è¯¥çœ‹åˆ°

- ç´«è‰²æ¸å˜çš„ç°ä»£åŒ–ç•Œé¢
- "è¯»ç§€ZIPè½¬PDF" æ ‡é¢˜
- ä¸Šä¼ åŒºåŸŸ
- æ—¥å¿—æ¡†

### 8.3 æµ‹è¯•è½¬æ¢

1. å‡†å¤‡ä¸€ä¸ªå°çš„ZIPæ–‡ä»¶ï¼ˆå»ºè®®<10MBï¼‰
2. æ‹–æ‹½æˆ–ç‚¹å‡»ä¸Šä¼ 
3. ç‚¹å‡»"å¼€å§‹è½¬æ¢ä¸ºPDF"
4. è§‚å¯Ÿæ—¥å¿—è¾“å‡º
5. è½¬æ¢æˆåŠŸåä¸‹è½½PDF

---

## 9. å¸¸è§é”™è¯¯åŠè§£å†³

### âŒ Error 1101 - Worker threw exception

**åŸå› ï¼š** Workerè¿è¡Œæ—¶å‡ºé”™

**è§£å†³æ–¹æ³•ï¼š**

1. **æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼š**
```powershell
npx wrangler tail
```
ç„¶ååœ¨æµè§ˆå™¨ä¸­æ“ä½œï¼Œè§‚å¯Ÿæ—¥å¿—è¾“å‡º

2. **é‡æ–°éƒ¨ç½²ï¼š**
```powershell
npm run deploy
```

3. **æ£€æŸ¥R2ç»‘å®šï¼š**
   - è®¿é—® https://dash.cloudflare.com/
   - Workers & Pages â†’ ä½ çš„Worker â†’ Settings â†’ Variables
   - ç¡®è®¤æœ‰ BUCKET ç»‘å®šåˆ° duxiu-pdf-storage

### âŒ Error: R2 bucket not found

**åŸå› ï¼š** R2å­˜å‚¨æ¡¶æœªæ­£ç¡®ç»‘å®š

**è§£å†³æ–¹æ³•ï¼š**

1. ç¡®è®¤å­˜å‚¨æ¡¶å­˜åœ¨ï¼š
```powershell
npx wrangler r2 bucket list
```

2. å¦‚æœæ²¡æœ‰ï¼Œåˆ›å»ºå®ƒï¼š
```powershell
npx wrangler r2 bucket create duxiu-pdf-storage
```

3. é‡æ–°éƒ¨ç½²ï¼š
```powershell
npm run deploy
```

### âŒ Error: Unauthorized

**åŸå› ï¼š** ç™»å½•çŠ¶æ€è¿‡æœŸ

**è§£å†³æ–¹æ³•ï¼š**
```powershell
npx wrangler login
```

### âŒ npm install å¤±è´¥

**åŸå› ï¼š** ç½‘ç»œé—®é¢˜

**è§£å†³æ–¹æ³•ï¼š**

ä½¿ç”¨æ·˜å®é•œåƒæºï¼š
```powershell
npm config set registry https://registry.npmmirror.com
npm install
```

### âŒ è½¬æ¢å¤±è´¥ï¼šæœåŠ¡å™¨é”™è¯¯...DOCTYPE

**åŸå› ï¼š** æ–‡ä»¶å¤ªå¤§æˆ–å¯†ç å°è¯•è¶…æ—¶

**è§£å†³æ–¹æ³•ï¼š**
- å°è¯•æ›´å°çš„æ–‡ä»¶
- å¦‚æœçŸ¥é“å¯†ç ï¼Œæ‰‹åŠ¨è¾“å…¥å¯†ç åé‡è¯•

### âŒ ZIPä¸­æ— å›¾ç‰‡

**åŸå› ï¼š** ZIPç»“æ„ä¸æ”¯æŒæˆ–æ–‡ä»¶æ ¼å¼ä¸å¯¹

**æ”¯æŒçš„æ ¼å¼ï¼š**
- PDGã€JPGã€PNGã€BMPã€TIFã€GIF

---

## ğŸ“ è¿›é˜¶é…ç½®

### è‡ªå®šä¹‰åŸŸå

1. åœ¨Cloudflare Dashboardä¸­
2. Workers & Pages â†’ ä½ çš„Worker â†’ Triggers
3. Add Custom Domain
4. è¾“å…¥ä½ çš„åŸŸåï¼ˆéœ€è¦å·²æ·»åŠ åˆ°Cloudflareï¼‰

### æŸ¥çœ‹æ—¥å¿—

```powershell
npx wrangler tail
```

### æœ¬åœ°å¼€å‘

```powershell
npm run dev
```
è®¿é—® http://localhost:8787

---

## ğŸ”§ å®Œæ•´å‘½ä»¤é€ŸæŸ¥

```powershell
# 1. å®‰è£…ä¾èµ–
npm install

# 2. ç™»å½•Cloudflare
npx wrangler login

# 3. åˆ›å»ºR2å­˜å‚¨æ¡¶
npx wrangler r2 bucket create duxiu-pdf-storage

# 4. éƒ¨ç½²
npm run deploy

# 5. æŸ¥çœ‹æ—¥å¿—
npx wrangler tail

# 6. æœ¬åœ°å¼€å‘
npm run dev
```

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**ï¼š`npx wrangler tail`
2. **æ£€æŸ¥Dashboard**ï¼šhttps://dash.cloudflare.com/
3. **æäº¤Issue**ï¼šåœ¨GitHubä»“åº“æäº¤é—®é¢˜

---

## âœ… éƒ¨ç½²æ¸…å•

- [ ] Node.jså·²å®‰è£…
- [ ] é¡¹ç›®ä»£ç å·²ä¸‹è½½
- [ ] npm install æˆåŠŸ
- [ ] wrangler login æˆåŠŸ
- [ ] R2å­˜å‚¨æ¡¶å·²åˆ›å»º
- [ ] npm run deploy æˆåŠŸ
- [ ] å¯ä»¥è®¿é—®Worker URL
- [ ] æµ‹è¯•è½¬æ¢æˆåŠŸ

**æ­å–œï¼ä½ çš„è¯»ç§€ZIPè½¬PDFå·¥å…·å·²ä¸Šçº¿ï¼** ğŸ‰

---

æœ€åæ›´æ–°ï¼š2025-12-25
